// Generated by CoffeeScript 1.3.3
(function() {

  require(['app', 'router', 'backbone'], function(app, Router, Backbone) {
    var getCurrentPageIndex, goLeft, goRight, hideArrowKeys, i, inTransition, jPlayerDiv, navbarLink, navbarLinks, numPages, p, pages, playSong, resizePage, selectOnClick, setSoundCloudLink, setTitle, transitionFinished, _i, _ref;
    window.app = app;
    app.router = new Router();
    Backbone.history.start({
      root: app.root
    });
    $(document).on("click", "a:not([data-bypass])", function(evt) {
      var href;
      href = $(this).attr("href");
      if (href && href.indexOf("#") === 0) {
        evt.preventDefault();
        return Backbone.history.navigate(href, {
          trigger: true
        });
      }
    });
    app.router.navigate('#home', {
      trigger: true
    });
    console.log("IN MAIN");
    $('#jp-no-solution-wrapper').hide();
    setTitle = function(title) {
      return $('#jp-title-text').html(title);
    };
    setSoundCloudLink = function(url) {
      if (!url) {
        return $('#soundCloudLink').hide();
      } else {
        $('#soundCloudLink').show();
        return $('#soundCloudLink').html('<a href="' + url + '"  target="_blank" id="asdf"> <img src="/images/soundcloud.png"/> </a>');
      }
    };
    jPlayerDiv = $("#jquery_jplayer_1");
    jPlayerDiv.jPlayer({
      ready: function() {},
      supplied: 'mp3',
      wmode: 'window'
    });
    playSong = function(songUrl, songTitle, soundCloudUrl, dontStartPlaying) {
      if (dontStartPlaying) {
        jPlayerDiv.jPlayer("setMedia", {
          mp3: songUrl
        }).jPlayer();
      } else {
        jPlayerDiv.jPlayer("setMedia", {
          mp3: songUrl
        }).jPlayer('play');
      }
      setTitle(songTitle);
      return setSoundCloudLink(soundCloudUrl);
    };
    $('.playableSong').click(function(e) {
      var songDiv, songTitle, songUrl, soundCloudUrl;
      songDiv = $(this);
      songUrl = songDiv.attr('url');
      songTitle = songDiv.attr('title');
      soundCloudUrl = songDiv.attr('soundCloudUrl');
      return playSong(songUrl, songTitle, soundCloudUrl);
    });
    playSong('https://s3.amazonaws.com/jvkoh-music/floatintheocean.mp3', 'Float in the Ocean', '', true);
    $('#soundCloudLink').css({
      position: 'relative',
      left: 45,
      top: 8
    }).show();
    p = parallax;
    pages = ['home', 'music', 'about'];
    pages.forEach(function(e) {
      return p.add(e, $('#' + e + 'Page'));
    });
    getCurrentPageIndex = function() {
      return pages.indexOf(p.current.key);
    };
    p.home.show();
    p.last = p.homepage;
    numPages = pages.length;
    hideArrowKeys = function() {
      $('.arrowKey').show();
      if (getCurrentPageIndex() === 0) {
        return $('#leftArrow').hide();
      } else if (getCurrentPageIndex() === (numPages - 1)) {
        return $('#rightArrow').hide();
      }
    };
    hideArrowKeys();
    goRight = function() {
      var nextPage;
      if (getCurrentPageIndex() < (numPages - 1)) {
        nextPage = pages[getCurrentPageIndex() + 1];
        return $('#' + nextPage).click();
      }
    };
    goLeft = function() {
      var nextPage;
      if (getCurrentPageIndex() > 0) {
        nextPage = pages[getCurrentPageIndex() - 1];
        return $('#' + nextPage).click();
      }
    };
    $(document).keydown(function(e) {
      if (e.keyCode === 39) {
        return goRight();
      } else if (e.keyCode === 37) {
        return goLeft();
      }
    });
    $('#rightArrow').click(function(e) {
      return goRight();
    });
    $('#leftArrow').click(function(e) {
      return goLeft();
    });
    navbarLinks = $(".navButton");
    inTransition = false;
    transitionFinished = function() {
      hideArrowKeys();
      inTransition = false;
      return $('body').removeClass('hideOverflow');
    };
    selectOnClick = function(navLink) {
      return navLink.click(function(e) {
        var navTitle;
        if (!inTransition) {
          inTransition = true;
          $('body').addClass('hideOverflow');
          navLink.parent().parent().children().removeClass('active');
          navLink.parent().toggleClass('active');
          navTitle = navLink.attr('href').substring(1);
          if (pages.indexOf(navTitle) < getCurrentPageIndex()) {
            return p[navTitle].left(transitionFinished);
          } else if (pages.indexOf(navTitle) > getCurrentPageIndex()) {
            return p[navTitle].right(transitionFinished);
          } else {
            return transitionFinished();
          }
        }
      });
    };
    for (i = _i = 0, _ref = navbarLinks.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
      navbarLink = $(navbarLinks[i]);
      navbarLink.attr('id', navbarLink.attr('href').substring(1));
      selectOnClick($(navbarLink));
    }
    resizePage = function() {
      return $('#bodyWrapper').height($($(p.current.page).children()[0]).outerHeight(true));
    };
    $(window).resize(function() {
      return resizePage();
    });
    resizePage();
    p.preload = function(thisPage) {
      return setTimeout(function() {
        return $('#bodyWrapper').height($($(thisPage.page).children()[0]).outerHeight(true));
      }, 100);
    };
    return setTimeout(function() {
      return $('#jp-no-solution-wrapper').show();
    }, 5000);
  });

}).call(this);
